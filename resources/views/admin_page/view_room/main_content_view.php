<div class="boxed">


        <!--CONTENT CONTAINER-->
        <!--===================================================-->
        <div id="content-container">
            <div class="pageheader">
                <h3><i class="fa fa-home"></i> Информация о номере <?php echo $room[0]['original']['id'];?> </h3>
                <div class="breadcrumb-wrapper"> <span class="label">You are here:</span>
                    <ol class="breadcrumb">
                        <li> <a href="#"> Home </a> </li>
                        <li class="active"> User Profile </li>
                    </ol>
                </div>
            </div>

            <!--Page content-->
            <!--===================================================-->
            <div id="page-content">
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">
                        <div class="panel">
                            <div class="panel-body np"> <img src="/photos/<?php echo $room[0]['original']['image_small'] ?>" alt="Cover" width="100%">
                                <div class="text-center">
                                    <!-- panel body -->
                                    <h4 class="text-lg text-overflow mar-top"><?php echo $room[0]['original']['name'] ?></h4>
                                    <p class="text-sm"><?php echo $room[0]['original']['slogan'] ?></p>
                                    <!--/ panel body -->
                                    <div class="pad-ver">
                                        <a title="" href="javascript:void(0)" class="btn btn-primary btn-icon btn-circle fa fa-facebook icon-lg add-tooltip" data-original-title="Facebook" data-container="body"></a>
                                        <a title="" href="javascript:void(0)" class="btn btn-info btn-icon btn-circle fa fa-twitter icon-lg add-tooltip" data-original-title="Twitter" data-container="body"></a>
                                        <a title="" href="javascript:void(0)" class="btn btn-danger btn-icon btn-circle fa fa-google-plus icon-lg add-tooltip" data-original-title="Google+" data-container="body"></a>
                                        <a title="" href="javascript:void(0)" class="btn btn-warning btn-icon btn-circle fa fa-envelope icon-lg add-tooltip" data-original-title="Email" data-container="body"></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title"><i class="fa fa-user"> </i> User Information</h3>
                            </div>
                            <div class="panel-body">
                                <table class="table">
                                    <tbody>
                                    <tr>
                                        <td><i class="fa fa-external-link ph-5"></i></td>
                                        <td> URL </td>
                                        <td> www.google.com</td>
                                    </tr>
                                    <tr>
                                        <td><i class="fa fa-envelope-o ph-5"></i></td>
                                        <td> Email </td>
                                        <td>peter@google.com </td>
                                    </tr>
                                    <tr>
                                        <td><i class="fa fa-phone ph-5"></i></td>
                                        <td> Phone </td>
                                        <td> (641)-734-4763 </td>
                                    </tr>
                                    <tr>
                                        <td><i class="fa fa-skype ph-5"></i></td>
                                        <td> Skype </td>
                                        <td> peterclark82 </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="panel">
                            <div class="panel-heading">
                                <h4 class="panel-title"> <i class="fa fa-users"></i> Online Friends </h4>
                            </div>
                            <div class="panel-body">
                                <ul class="list-inline">
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av1.png" alt="" class="img-sm">
                                            <i class="on bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av2.png" alt="" class="img-sm">
                                            <i class="on bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av3.png" alt="" class="img-sm">
                                            <i class="busy bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av4.png" alt="" class="img-sm">
                                            <i class="busy bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av5.png" alt="" class="img-sm">
                                            <i class="on bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av6.png" alt="" class="img-sm">
                                            <i class="on bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av7.png" alt="" class="img-sm">
                                            <i class="busy bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av1.png" alt="" class="img-sm">
                                            <i class="on bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av2.png" alt="" class="img-sm">
                                            <i class="on bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av3.png" alt="" class="img-sm">
                                            <i class="on bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av4.png" alt="" class="img-sm">
                                            <i class="busy bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av5.png" alt="" class="img-sm">
                                            <i class="busy bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av6.png" alt="" class="img-sm">
                                            <i class="on bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av7.png" alt="" class="img-sm">
                                            <i class="on bottom text-light"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" class="pull-left avatar">
                                            <img src="img/av4.png" alt="" class="img-sm">
                                            <i class="on bottom text-light"></i>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title"><i class="fa fa-user"> </i> User Information</h3>
                            </div>
                            <div class="panel-body">
                                <table class="table">
                                    <tbody>
                                    <tr>
                                        <td> Position </td>
                                        <td>UI Designer</td>
                                    </tr>
                                    <tr>
                                        <td> Last Logged In </td>
                                        <td>56 min </td>
                                    </tr>
                                    <tr>
                                        <td> Status </td>
                                        <td><span class="label label-sm label-info">Administrator</span></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">
                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title">Панель преференций</h3>
                            </div>
                            <div class="panel-body">
                                <!-- Timeline -->
                                <!--===================================================-->
                                <div class="timeline">

                                    <!-- Timeline header -->
                                    <div class="timeline-header">
                                        <div class="timeline-header-title bg-info">Изменить данные</div>
                                    </div>
                                    <div class="timeline-entry">
                                        <div class="timeline-stat">
                                            <div class="timeline-icon bg-purple"><i class="fa fa-check fa-lg"></i> </div>
                                        </div>
                                        <div class="timeline-label"> <img class="img-xs img-circle" src="img/av1.png" alt="Основное фото номера"> Вы можете изменить его.
                                            <div> <img src="/photos/<?php echo $room[0]['original']['thumbnail'] ?>" class="profile-img" align="left">
                                                <button class="btn btn-warning btn-rounded btn-labeled fa fa-gift">Поменять основное фото этого номера</button>
                                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat...</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="timeline-entry">
                                        <div class="timeline-stat">
                                            <div class="timeline-icon bg-mint"><i class="fa fa-users fa-lg"></i> </div>
                                        </div>
                                        <div class="timeline-label"> <img class="img-xs img-circle" src="img/av4.png" alt="Profile picture"> <a href="#" class="btn-link text-semibold">Shirley Anderson</a> started following. <img class="img-xs img-circle" src="img/av7.png" alt="Profile picture"> <img class="img-xs img-circle" src="img/av6.png" alt="Profile picture"></div>
                                    </div>
                                    <div class="timeline-entry">
                                        <div class="timeline-stat">
                                            <div class="timeline-icon bg-primary"><i class="fa fa-image fa-lg"></i> </div>
                                        </div>
                                        <div class="timeline-label"> <img class="img-xs img-circle" src="img/av1.png" alt="Фотографии номера"> <a href="#" class="btn-link text-semibold"></a> Загружено <?php echo count($photos)?> <?php
                                            if(count($photos)==1){ echo "фотография";}
                                            if(count($photos)>1 && count($photos)<5){ echo "фотографии";}
                                            if(count($photos)>4) { echo "фотографий";}
                                            ?>
                                            <h4></h4>
                                            <div>

                                                <?php foreach($photos as $photo){

                                                    ?>
                                                    <div class="pre_modal" style="position:relative; display:inline-block">
                                                        <img src="/photos/<?php echo $photo['original']['thumbnail'] ?>" class="profile-img" alt="">
                                                        <button style="position:absolute;top:7px;left:120px;" data-toggle="modal_danger" class="btn btn-danger btn-icon btn-circle icon-lg fa fa-times"></button>
                                                        <input class="premodal_hidden" type="hidden" value="<?php echo $photo['original']['id'] ?>">
                                                        <button style="position:absolute;top:56px;left:120px;" data-toggle="modal" data-target="#myModal" class="btn_refresh btn btn-warning btn-icon btn-circle icon-lg fa fa-refresh"></button>





                                                    </div>
                                                    <?

                                                }?>


                                            </div>
                                        </div>
                                    </div>
                                    <div class="timeline-entry">
                                        <div class="timeline-stat">
                                            <div class="timeline-icon bg-info"><i class="fa fa-tasks fa-lg"></i> </div>
                                        </div>
                                        <div class="timeline-label"> <img class="img-xs img-circle" src="img/av4.png" alt="Profile picture"> <a href="#" class="btn-link text-semibold">Shirley Anderson</a> completed the task “Application UI Re-design” within the dead line</div>
                                    </div>



                                </div>
                                <!--===================================================-->
                                <!-- End Timeline -->
                            </div>
                        </div>

<!--
                <button type="button" class="btn btn-info btn-lg"  >Open Modal</button>-->

                <!-- Modal -->





                                <div class="timeline-entry">
                                    <div class="timeline-stat">
                                        <div class="timeline-icon"><img src="img/av4.png" alt="Profile picture"></div>
                                    </div>
                                    <div class="timeline-label">

                                        <div class="panel">
                                            <div class="panel-heading">
                                                <h3 class="panel-title">Calendar</h3>
                                            </div>
                                            <div class="panel-body">
                                                <!-- Calendar placeholder-->
                                                <!-- ============================================ -->
                                                <div id="demo-calendar" class="fc fc-ltr fc-unthemed">

                                                </div>
                                                <!-- ============================================ -->

                                                <script>

                                                    // Misc-FullCalendar.js
                                                    // ====================================================================
                                                    // This file should not be included in your project.
                                                    // This is just a sample how to initialize plugins or components.
                                                    //
                                                    // - ThemeOn.net -
                                                    var dayModalEdited;
                                                    var mini_array = new Array();

                                                    $(document).ready(function () {

                                                        $.ajaxSetup({
                                                            headers: {
                                                                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                                                            }
                                                        });
                                                        $.ajax({
                                                            type: "POST",
                                                            dataType: 'json',
                                                            url: '/get_calendar_data',
                                                            data: {room_id:<?php echo $room[0]['original']['id']?>},
                                                            success: function (data_) {
                                                                var _data_ = data_;
                                                                // initialize the external events
                                                                // -----------------------------------------------------------------
                                                                $('#demo-external-events .fc-event').each(function () {
                                                                    // store data so the calendar knows to render an event upon drop
                                                                    $(this).data('event', {
                                                                        title: $.trim($(this).text()), // use the element's text as the event title
                                                                        stick: true, // maintain when user navigates (see docs on the renderEvent method)
                                                                        className: $(this).data('class'),
                                                                        type: $(this).data('type')
                                                                    });
                                                                    // make the event draggable using jQuery UI
                                                                    $(this).draggable({
                                                                        zIndex: 99999,
                                                                        revert: true,      // will cause the event to go back to its
                                                                        revertDuration: 0  //  original position after the drag
                                                                    });
                                                                });
                                                                // Initialize the calendar
                                                                // -----------------------------------------------------------------
//                                                                var massiv = new Array();
                                                                $.each(_data_, function (key, value) {
                                                                    mini_array.push({
                                                                        title: value.price_per_day + 'грн. ' + value.title,
                                                                        start: value.start_data,
                                                                        end: value.end_data,
                                                                        id: value.id,
                                                                        type: value.type,
                                                                        className: value.class_name,
                                                                        room_id: value.room_id,
                                                                        price_per_day: value.price_per_day
                                                                    });
                                                                });
//                                                                console.log(mini_array);
                                                                $('#demo-calendar').fullCalendar({
                                                                    header: {
                                                                        left: 'prev,next, today',
                                                                        center: 'title',
                                                                        right: 'month,agendaWeek,agendaDay'
                                                                    },
                                                                    editable: true,
                                                                    droppable: true, // this allows things to be dropped onto the calendar
                                                                    defaultDate: '2017-04-04',
                                                                    selectable: true,
                                                                    allDayDefault: true,
                                                                    selectHelper: true,
                                                                    select: function (start, end) {
                                                                        clearModalData();
                                                                        dayModalEdited = {
                                                                            start: start,
                                                                            end: end
                                                                        };
                                                                        $("#dayEdit").modal("show");
                                                                        setTimeout(function () {
                                                                            $('input.event_title').get(0).focus()
                                                                        }, 1000);
                                                                    },
                                                                    eventClick: function (calEvent) {
                                                                        clearModalData();
                                                                        $('.event_id').val(calEvent.id);
                                                                        $('.event_title').val(calEvent.title);
                                                                        $('.event_price').val(calEvent.price_per_day);
                                                                        $('.event_status').each(function () {
                                                                            if ($(this).val() == calEvent.type) {
                                                                                $(this).prop('checked', true);
                                                                            }
                                                                        });
                                                                        $("#dayEdit").modal("show");
                                                                        setTimeout(function () {
                                                                            $('input.event_title').get(0).focus()
                                                                        }, 1000);
                                                                    },
                                                                    eventDrop: function (event) {

                                                                        var update_event = {
                                                                            id: event.id,
                                                                            start_data: event.start,
                                                                            end_data: event.end,
                                                                            room_id: mini_array[0].room_id
                                                                        };
                                                                        $.ajax({
                                                                            type: 'POST',
                                                                            url: '/admin/setting_room_price',
                                                                            contentType: "application/json",
                                                                            data: JSON.stringify(update_event),
                                                                            success: function (response) {
                                                                                if (response == 'true') {
                                                                                    $('#demo-calendar').fullCalendar('refetchEvents');
                                                                                    console.log('Сохранено!');
                                                                                }
                                                                                else {
                                                                                    console.log('Но нет, сохранить не удалось!');
                                                                                }
                                                                            }
                                                                        });
                                                                    },
                                                                    eventResize: function (event) {
                                                                        var update_event = {
                                                                            id: event.id,
                                                                            start_data: event.start,
                                                                            end_data: event.end,
                                                                            room_id: mini_array[0].room_id
                                                                        };
                                                                        $.ajax({
                                                                            type: 'POST',
                                                                            url: '/admin/setting_room_price',
                                                                            contentType: "application/json",
                                                                            data: JSON.stringify(update_event),
                                                                            success: function (response) {
                                                                                if (response == 'true') {
                                                                                    $('#demo-calendar').fullCalendar('refetchEvents');
                                                                                    console.log('Сохранено!');
                                                                                }
                                                                                else {
                                                                                    console.log('Но нет, сохранить не удалось!');
                                                                                }
                                                                            }
                                                                        });
                                                                    },
                                                                    eventRender: function (event, element) {
                                                                        element.html(event.title + '<span class="removeEvent glyphicon glyphicon-trash pull-right" data-action="delete"></span><div class="fc-resizer"></div>');
                                                                        element.find('.removeEvent').click(function () {
                                                                            $('#demo-calendar').fullCalendar('removeEvents', event._id);
                                                                            $.ajax({
                                                                                type: 'POST',
                                                                                url: '/delete_calendar_data',
                                                                                data: {
                                                                                    id: event.id,
                                                                                    room_id: mini_array[0].room_id
                                                                                },
                                                                                success: function (response) {
                                                                                    if (response == 'true') {
                                                                                        $('#demo-calendar').fullCalendar('refetchEvents');
                                                                                        console.log('Удалено!');
                                                                                    }
                                                                                    else {
                                                                                        console.log('Но нет, удалить не удалось!');
                                                                                    }
                                                                                }
                                                                            });
                                                                        });
                                                                    },
                                                                    drop: function (date, jsEvent) {
                                                                        dayModalEdited = {
                                                                            start: date,
                                                                            end: date
                                                                        };
                                                                        clearModalData();
                                                                        $('.event_status').each(function () {
                                                                            if ($(this).val() == jsEvent.toElement.dataset.type) {
                                                                                $(this).prop('checked', true);
                                                                            }
                                                                        });
                                                                        $("#dayEdit").modal("show");
                                                                        setTimeout(function () {
                                                                            $('input.event_title').get(0).focus()
                                                                        }, 1000);
                                                                    },
//                                                                    eventAfterRender: function (event, element, view) {
//                                                                        $(element).attr("id", "event_id_" + event._id);
//                                                                    },
                                                                    eventLimit: false, // allow "more" link when too many events
                                                                    events: function (start, end, timezone, callback) {
                                                                        var events = [];
                                                                        $.ajax({
                                                                            type: "POST",
                                                                            dataType: 'json',
                                                                            url: '/get_calendar_data',
                                                                            data: {room_id:<?php echo $room[0]['original']['id']?>},
                                                                            success: function (data_) {
                                                                                var _data_ = data_;
                                                                                $.each(_data_, function (key, value) {
                                                                                    events.push({
                                                                                        title: value.price_per_day + 'грн. ' + value.title,
                                                                                        start: value.start_data,
                                                                                        end: value.end_data,
                                                                                        id: value.id,
                                                                                        type: value.type,
                                                                                        className: value.class_name,
                                                                                        room_id: value.room_id,
                                                                                        price_per_day: value.price_per_day
                                                                                    });
                                                                                });
                                                                                callback(events);
                                                                            }
                                                                        });
                                                                    }
                                                                });
                                                            }

                                                        });

                                                        // Calendar
                                                        // =================================================================
                                                        // Require Full Calendar
                                                        // -----------------------------------------------------------------
                                                        // http://fullcalendar.io/
                                                        // =================================================================

//                                                        saveDay();

                                                        $('#dayEdit').on('hidden.bs.modal', function () {
                                                            clearModalData();
                                                        });
                                                        $('.save_day').on('click', function () {
                                                            var start = dayModalEdited.start;
                                                            var end = dayModalEdited.end;
                                                            var title = $('.event_title').val();
                                                            var price_per_day = $('.event_price').val();
                                                            var status = $('input.event_status:checked').val();
                                                            var class_name;
                                                            if (status == 'free') {
                                                                class_name = 'purple';
                                                            } else {
                                                                if (status == 'booked') {
                                                                    class_name = 'mint';
                                                                } else {
                                                                    class_name = 'warning';
                                                                }
                                                            }
                                                            var new_event = {
                                                                title: title,
                                                                price_per_day: price_per_day,
                                                                start: start,
                                                                start_data: start,
                                                                end: end,
                                                                end_data: end,
                                                                type: status,
                                                                className: class_name,
                                                                room_id: mini_array[0].room_id
                                                            };
                                                            $('#demo-calendar').fullCalendar('renderEvent', new_event);
                                                            new_event.class_name = class_name;

                                                            var id = $('.event_id').val();
                                                            if (id) {
                                                                new_event.id = id;
                                                                $.ajax({
                                                                    type: 'POST',
                                                                    url: '/admin/update_room_info',
                                                                    contentType: "application/json",
                                                                    data: JSON.stringify(new_event),
                                                                    success: function (response) {
                                                                        if (response == 'true') {
                                                                            $('#demo-calendar').fullCalendar('refetchEvents');
                                                                            console.log('Сохранено!');
                                                                        }
                                                                        else {
                                                                            console.log('Но нет, сохранить не удалось!');
                                                                        }
                                                                    }
                                                                });
                                                            } else {
                                                                $.ajax({
                                                                    type: 'POST',
                                                                    url: '/admin/setting_room_price',
                                                                    contentType: "application/json",
                                                                    data: JSON.stringify(new_event),
                                                                    success: function (response) {
                                                                        if (response == 'true') {
                                                                            $('#demo-calendar').fullCalendar('refetchEvents');
                                                                            console.log('Сохранено!');
                                                                        }
                                                                        else {
                                                                            console.log('Но нет, сохранить не удалось!');
                                                                        }
                                                                    }
                                                                });
                                                            }
                                                            clearModalData();
                                                            $("#dayEdit").modal("hide");

                                                        });
                                                    });

                                                    function clearModalData() {
                                                        $('.event_id').val('');
                                                        $('.event_title').val('');
                                                        $('.event_price').val('');
                                                        $('.event_status').each(function () {
                                                            if ($(this).val() == 'free') {
                                                                $(this).prop('checked', true);
                                                            } else {
                                                                $(this).prop('checked', false);
                                                            }
                                                        });
                                                    }

                                                    function putting(start) {
                                                        $.ajaxSetup({
                                                            headers: {
                                                                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                                                            }
                                                        });
                                                        alert(start)

                                                    }
                                                </script>

                                            </div>
                                        </div>


                                    </div>
                                </div>


                                <div class="timeline-entry">
                                    <div class="timeline-stat">
                                        <div class="timeline-icon bg-purple"><i class="fa fa-check fa-lg"></i></div>
                                    </div>
                                    <div class="timeline-label"><img class="img-xs img-circle" src="img/av3.png"
                                                                     alt="Profile picture"> <a href="#"
                                                                                               class="btn-link text-semibold">Bobby
                                            Marz</a> followed you.
                                    </div>
                                </div>
                                <div class="timeline-entry">
                                    <div class="timeline-stat">
                                        <div class="timeline-icon"><img src="img/av4.png" alt="Profile picture"></div>
                                    </div>
                                    <div class="timeline-label">
                                        <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy
                                            nibh euismod tincidunt.</p>
                                    </div>
                                </div>
                            </div>
                            <!--===================================================-->
                            <!-- End Timeline -->
                        </div>
                    </div>
<!--                </div>
            </div>
        </div>-->
        <!--===================================================-->
        <!--End page content-->

    </div>
    <!--===================================================-->
    <!--END CONTENT CONTAINER-->
    <style type="text/css">
        .removeEvent {
            position: absolute !important;
            top: 8px !important;
            right: 10px !important;
        }
    </style>



<!--===================================================-->
<!--END CONTENT CONTAINER-->
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Поменять существующую фотографию</h4>
            </div>
            <div class="modal-body">


                <div id="appl_window1" style="width:100%">

                    <div id="close_window1" class="del_prod_btn"></div>
                    <div id="add_photo1">
                        <br>
                        <h6>Выберите
                            <?
                            $count_images=1;
                            $image_width=1200;
                            $image_height=800;
                            $image_type='logo';
                            $image_index=1;
                            echo $count_images;
                            if($count_images==1){
                                echo "фотографию";
                            }
                            else if($count_images>1 && $count_images<5){
                                echo "фотографии";
                            }
                            else if($count_images>4){
                                echo "фотографий";
                            }
                            ?>
                            (не более 2М)
                            <?=$image_width?>х<?=$image_height?>px -
                            <?if($image_type=='logo'){
                                echo "логотип данного производителя";
                            }
                            else if($image_type=='door'){
                                echo "фотографии выбранной двери";
                            }
                            else if($image_type=='material' or $image_type=='material_edit'){
                                echo "фотографии материала";
                            }
                            ?>
                        </h6>
                        <label>Фотография*<span>&nbsp;&nbsp;&nbsp;       Чтобы добавить картинку, нажми обзор или просто перетащи в желтую область ниже &dArr;<hr></span></label>
                        <br>
                        <input type="file" name="my-pic[]" id="file-field4" class="image" multiple="multiple"/>
                        <a id="cancel-all4">Отменить все</a>
                        <div id="img-container4">
                            <ul id="img-list4"></ul>
                        </div>
                        <div id="leftpanel1">
                            <div id="actions1">


                                <input type="hidden" name="lwidth" value="<?=$image_width?>">
                                <input type="hidden" name="lheight" value="<?=$image_height?>">
                                <input type="hidden" name="lproducers" value="/upload">
                                <input type="hidden" name="ltype" value="<?=$image_type?>">
                                <span id="info-count1">Изображений не выбрано</span><br/>
                                Общий размер:<span id="info-size1">0</span> Кб<br/><br/>
                            </div>
                            <div id="console4"></div>
                            <div style="width:250px;" class="btn btn-primary apply_btn1">Сохранить фото на сервере</div>

                        </div>
                    </div>
                </div>

                <script>




                    $(document).ready(function() {

                        $('.btn_refresh').click(function(){

                            window.refresh=$(this).parent('.pre_modal').find('.premodal_hidden').val();
                            

                        });
                        // Консоль
                        var $console = $("#console4");

                        // Инфа о выбранных файлах
                        var countInfo = $("#info-count1");
                        var sizeInfo = $("#info-size1");

                        // ul-список, содержащий миниатюрки выбранных файлов
                        var imgList = $('#img-list4');

                        // Контейнер, куда можно помещать файлы методом drag and drop
                        var dropBox = $('#img-container4');

                        // Счетчик всех выбранных файлов и их размера
                        var imgCount = 0;
                        var imgSize = 0;


                        // Стандарный input для файлов
                        var fileInput = $('#file-field4');

                        // Тестовый canvas
                        /*  var canvas = document.getElementById('canvas');
                         var ctx = canvas.getContext("2d");
                         ctx.fillStyle = "rgb(128,128,128)";
                         ctx.fillRect (0, 0, 150, 150);
                         ctx.fillStyle = "rgb(200,0,0)";
                         ctx.fillRect (10, 10, 55, 50);
                         ctx.fillStyle = "rgba(0, 0, 200, 0.5)";
                         ctx.fillRect (30, 30, 55, 50); */


                        ////////////////////////////////////////////////////////////////////////////
                        // Подключаем и настраиваем плагин загрузки

                        fileInput.damnUploader({
                            // куда отправлять
                            url: '/functions_image_update',
                            // имитация имени поля с файлом (будет ключом в $_FILES, если используется PHP)
                            fieldName:  'my-pic',
                            // дополнительно: элемент, на который можно перетащить файлы (либо объект jQuery, либо селектор)
                            dropBox: dropBox,
                            // максимальное кол-во выбранных файлов (если не указано - без ограничений)
                            limit: <?echo $count_images?>,
                            // когда максимальное кол-во достигнуто (вызывается при каждой попытке добавить еще файлы)
                            onLimitExceeded: function() {
                                log('Допустимое кол-во файлов уже выбрано');
                            },
                            // ручная обработка события выбора файла (в случае, если выбрано несколько, будет вызвано для каждого)
                            // если обработчик возвращает true, файлы добавляются в очередь автоматически
                            onSelect: function(file) {
                                addFileToQueue(file);
                                return false;
                            },
                            // когда все загружены
                            onAllComplete: function() {

                                log('<span style="color: blue;">*** Все загрузки завершены! ***</span>');
                                imgCount = 0;
                                imgSize = 0;
                                updateInfo();

                            }
                        });



                        ////////////////////////////////////////////////////////////////////////////
                        // Вспомогательные функции

                        // Вывод в консоль
                        function log(str) {
                            $('<p/>').html(str).prependTo($console);
                        }

                        // Вывод инфы о выбранных
                        function updateInfo() {
                            countInfo.text( (imgCount == 0) ? 'Изображений не выбрано' : ('Изображений выбрано: '+imgCount));
                            sizeInfo.text( (imgSize == 0) ? '-' : Math.round(imgSize / 1024));
                        }

                        // Обновление progress bar'а
                        function updateProgress(bar, value) {
                            var width = bar.width();
                            var bgrValue = -width + (value * (width / 100));
                            bar.attr('rel', value).css('background-position', bgrValue+'px center').text(value+'%');
                        }

                        // преобразование формата dataURI в Blob-данные
                        function dataURItoBlob(dataURI) {
                            var BlobBuilder = (window.MSBlobBuilder || window.MozBlobBuilder || window.WebKitBlobBuilder || window.BlobBuilder);
                            if (!BlobBuilder) {
                                return false;
                            }
                            // convert base64 to raw binary data held in a string
                            // doesn't handle URLEncoded DataURIs
                            var pieces = dataURI.split(',');
                            var byteString = (pieces[0].indexOf('base64') >= 0) ? atob(pieces[1]) : unescape(pieces[1]);
                            // separate out the mime component
                            var mimeString = pieces[0].split(':')[1].split(';')[0];
                            // write the bytes of the string to an ArrayBuffer
                            var ab = new ArrayBuffer(byteString.length);
                            var ia = new Uint8Array(ab);
                            for (var i = 0; i < byteString.length; i++) {
                                ia[i] = byteString.charCodeAt(i);
                            }
                            // write the ArrayBuffer to a blob, and you're done
                            var bb = new BlobBuilder();
                            bb.append(ab);
                            return bb.getBlob(mimeString);
                        }



                        // Отображение выбраных файлов, создание миниатюр и ручное добавление в очередь загрузки.
                        function addFileToQueue(file) {

                            // Создаем элемент li и помещаем в него название, миниатюру и progress bar
                            var li = $('<li/>').appendTo(imgList);
                            /* var title = $('<div/>').text(file.name+' ').appendTo(li); */
                            var cancelButton = $('<a/>').attr({
                                href: '#cancel',
                                title: 'отменить'
                            }).html('<img height="15" width="15" alt="X" src="/img/deleteIcon.png">').appendTo(/* title */li);

                            // Если браузер поддерживает выбор файлов (иначе передается специальный параметр fake,
                            // обозночающий, что переданный параметр на самом деле лишь имитация настоящего File)
                            if(!file.fake) {

                                // Отсеиваем не картинки
                                var imageType = /video.*/;
                                var imageType2 = /image.*/;
                                if (!file.type.match(imageType) && !file.type.match(imageType2)) {
                                    log('Файл отсеян: `'+file.name+'` (тип '+file.type+')');
                                    return true;
                                }

                                // Добавляем картинку и прогрессбар в текущий элемент списка
                                var div = $('<div/>').addClass('photo_frame').attr('rel', '0').appendTo(li);
                                var img = $('<img/>').appendTo(li);
                                /* var pBar = $('<div/>').addClass('progress').attr('rel', '0').text('0%').appendTo(li); */
                                // Создаем объект FileReader и по завершении чтения файла, отображаем миниатюру и обновляем
                                // инфу обо всех файлах (только в браузерах, подерживающих FileReader)
                                if($.support.fileReading) {
                                    var reader = new FileReader();
                                    reader.onload = (function(aImg) {
                                        return function(e) {

                                            aImg.attr('src', e.target.result);

                                            aImg.attr('height', 100);
                                        };
                                    })(img);
                                    reader.readAsDataURL(file);
                                }

                                log('Картинка добавлена: `'+file.name + '` (' +Math.round(file.size / 1024) + ' Кб)');
                                imgSize += file.size;
                            } else {
                                log('Файл добавлен: '+file.name);
                            }

                            imgCount++;
                            updateInfo();

                            // Создаем объект загрузки
                            var uploadItem = {
                                file: file,
                                /*  onProgress: function(percents) {
                                 updateProgress(pBar, percents);
                                 }, */
                                onComplete: function(successfully, data, errorCode) {

                                    if(successfully) {

                                        log('Файл `'+this.file.name+'` загружен, полученные данные:<br/>*****<br/>'+data+'<br/>*****');
                                    } else{
                                        if(!this.cancelled) {
                                            log('<span style="color:red;">Файл `'+this.file.name+'`: ошибка при загрузке. Код: '+errorCode+'</span>');
                                        }
                                    }
                                }
                            };

                            // ... и помещаем его в очередь
                            var queueId = fileInput.damnUploader('addItem', uploadItem);

                            // обработчик нажатия ссылки "отмена"
                            cancelButton.click(function() {
                                fileInput.damnUploader('cancel', queueId);
                                li.remove();
                                imgCount--;
                                imgSize -= file.fake ? 0 : file.size;
                                updateInfo();
                                log(file.name+' удален из очереди');
                                return false;
                            });

                            return uploadItem;
                        }




                        ////////////////////////////////////////////////////////////////////////////
                        // Обработчики событий


                        // Обработка событий drag and drop при перетаскивании файлов на элемент dropBox
                        dropBox.bind({
                            dragenter: function() {
                                $(this).addClass('highlighted');
                                return false;
                            },
                            dragover: function() {
                                return false;
                            },
                            dragleave: function() {
                                $(this).removeClass('highlighted');
                                return false;
                            }
                        });


                        // Обаботка события нажатия на кнопку "Загрузить все".
                        // стартуем все загрузки
                        $(".apply_btn1").click(function() {
                            fileInput.damnUploader('startUpload');

                        });


                        // Обработка события нажатия на кнопку "Отменить все"
                        $("#cancel-all4").click(function(){
                            fileInput.damnUploader('cancelAll');
                            imgCount = 0;
                            imgSize = 0;
                            updateInfo();
                            log('*** Все загрузки отменены ***');
                            imgList.empty();
                        });


                        // Обработка нажатия на тестовую канву
                        /*     $(canvas).click(function() {
                         var blobData;
                         if (canvas.toBlob) {
                         // ожидается, что вскоре браузерами будет поддерживаться метод toBlob() для объектов Canvas
                         blobData = canvas.toBlob();
                         } else {
                         // ... а пока - конвертируем вручную из dataURI
                         blobData = dataURItoBlob(canvas.toDataURL('image/png'));
                         }
                         if (blobData === false) {
                         log("Ваш браузер не поддерживает BlobBuilder");
                         return ;
                         }
                         addFileToQueue(blobData)
                         }); */




                        ////////////////////////////////////////////////////////////////////////////
                        // Проверка поддержки File API, FormData и FileReader

                        if(!$.support.fileSelecting) {
                            log('Ваш браузер не поддерживает выбор файлов (загрузка будет осуществлена обычной отправкой формы)');
                            $("#dropBox-label").text('если бы ты использовал хороший браузер, файлы можно было бы перетаскивать прямо в область ниже!');
                        } else {
                            if(!$.support.fileReading) {
                                log('* Ваш браузер не умеет читать содержимое файлов (миниатюрки не будут показаны)');
                            }
                            if(!$.support.uploadControl) {
                                log('* Ваш браузер не умеет следить за процессом загрузки (progressbar не работает)');
                            }
                            if(!$.support.fileSending) {
                                log('* Ваш браузер не поддерживает объект FormData (отправка с ручной формировкой запроса)');
                            }
                            log('Выбор файлов поддерживается');
                        }
                        log('*** Проверка поддержки ***');


                    });


                </script>




                <p>Some text in the modal.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>
    
    
    
    
